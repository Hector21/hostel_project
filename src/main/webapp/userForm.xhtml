<html xmlns="http://www.w3.org/1999/xhtml" xmlns:c="http://java.sun.com/jstl/core"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:t="http://myfaces.apache.org/tomahawk"
    xmlns:v="http://shale.apache.org/validator">

<f:view>
    <f:loadBundle var="text" basename="#{userForm.bundleName}" />
    <head>
    <title>#{text['userProfile.title']}</title>
    <meta name="menu" content="UserMenu" />
    <meta name="heading" content="#{text['userProfile.heading']}" />
    </head>

    <div class="separator"></div>

    <h:form id="userForm" onsubmit="return validateUserForm(this)">
        <h:inputHidden value="#{userForm.user.id}" id="id" />
        <h:inputHidden value="#{userForm.user.version}" id="version" />

        <h:inputHidden value="#{userForm.user.password}" id="originalPassword" />
        <input type="hidden" name="from" value="#{userForm.from}" />

        <c:if test="${userForm.rememberMe}">
            <h:inputHidden value="#{userForm.user.password}" id="password" />
            <h:inputHidden value="#{userForm.user.confirmPassword}" id="confirmPassword" />
        </c:if>

        <c:if test="${empty userForm.user.version}">
            <input type="hidden" name="encryptPass" value="true" />
        </c:if>

        <c:set var="addText" value="#{text['button.add']}" />

        <h:panelGrid columns="3">

            <h:panelGroup styleClass="info">
                <c:choose>
                    <c:when test="${param.from == 'list' or empty userForm.user.id}">
                        <h:outputText value="#{text['userProfile.admin.message']}" />
                    </c:when>
                    <c:otherwise>
                        <h:outputText value="#{text['userProfile.message']}" />
                    </c:otherwise>
                </c:choose>
            </h:panelGroup>
            <h:outputText />
            <h:outputText />

            <h:panelGroup>
                <t:htmlTag value="div">
                    <t:htmlTag value="div" styleClass="left">
                        <h:outputLabel for="lastName" value="#{text['user.lastName']}" styleClass="desc" />
                        <t:message for="lastName" styleClass="fieldError" />
                        <h:inputText value="#{userForm.user.lastName}" id="lastName" maxlength="50" required="true"
                            styleClass="text medium">
                            <v:commonsValidator client="true" type="required" arg="#{text['user.lastName']}" />
                        </h:inputText>
                    </t:htmlTag>
                    <t:htmlTag value="div">
                        <h:outputLabel for="firstName" value="#{text['user.firstName']}" styleClass="desc" />
                        <t:message for="firstName" styleClass="fieldError" />
                        <h:inputText id="firstName" value="#{userForm.user.firstName}" maxlength="50" required="true"
                            styleClass="text medium">
                            <v:commonsValidator client="true" type="required" arg="#{text['user.firstName']}" />
                        </h:inputText>
                    </t:htmlTag>
                </t:htmlTag>
            </h:panelGroup>
            <h:outputText />
            <h:outputText />

            <h:panelGroup>
                <t:htmlTag value="div">
                    <h:outputLabel for="middleName" value="#{text['user.middleName']}" styleClass="desc" />
                    <t:message for="middleName" styleClass="fieldError" />
                    <h:inputText value="#{userForm.user.middleName}" id="middleName" required="true"
                        styleClass="text medium">
                        <v:commonsValidator client="true" type="required" arg="#{text['user.middleName']}" />
                    </h:inputText>
                </t:htmlTag>
            </h:panelGroup>
            <h:outputText />
            <h:outputText />

            <h:panelGroup>
                <t:htmlTag value="div">
                    <t:htmlTag value="div" styleClass="left">
                        <h:outputLabel for="room" value="#{text['user.room']}" styleClass="desc" />
                        <t:message for="room" styleClass="fieldError" />
                        <h:inputText value="#{userForm.user.address.hostelRoom}" id="room" required="true"
                            styleClass="text medium">
                            <v:commonsValidator client="true" type="required" arg="#{text['user.room']}" />
                        </h:inputText>
                    </t:htmlTag>
                    <t:htmlTag value="div">
                        <h:outputLabel for="group" value="#{text['user.universityGroup']}" styleClass="desc" />
                        <t:message for="group" styleClass="fieldError" />
                        <h:inputText value="#{userForm.user.universityGroup}" id="group" required="true"
                            styleClass="text medium">
                            <v:commonsValidator client="true" type="required" arg="#{text['user.universityGroup']}" />
                        </h:inputText>
                    </t:htmlTag>
                </t:htmlTag>
            </h:panelGroup>
            <h:outputText />
            <h:outputText />

            <c:choose>
                <c:when test="${param.from == 'list' or param['editUser:add'] == addText}">
                    <h:panelGroup>
                        <t:htmlTag value="fieldset">
                            <t:htmlTag value="legend">
                                <h:outputText value="#{text['userProfile.accountSettings']}" />
                            </t:htmlTag>
                            <h:selectBooleanCheckbox value="#{userForm.user.enabled}" id="enabled" styleClass="checkbox" />
                            <h:outputLabel for="enabled" styleClass="choice" value="#{text['user.enabled']}" />

                            <h:selectBooleanCheckbox value="#{userForm.user.accountLocked}" id="accountLocked"
                                styleClass="checkbox" />
                            <h:outputLabel for="accountLocked" styleClass="choice" value="#{text['user.accountLocked']}" />
                        </t:htmlTag>
                    </h:panelGroup>
                    <h:outputText />
                    <h:outputText />
                </c:when>
                <c:otherwise>
                    <h:panelGroup>
                        <t:htmlTag value="strong">#{text['user.roles']}:</t:htmlTag>
                        <c:forEach var="role" items="#{userForm.userRoles}" varStatus="status">
               ${role}<c:if test="${!status.last}">,</c:if>
                            <input type="hidden" name="userForm:userRoles" value="${role}" />
                        </c:forEach>
                        <h:inputHidden value="#{userForm.user.enabled}" />
                        <h:inputHidden value="#{userForm.user.accountExpired}" />
                        <h:inputHidden value="#{userForm.user.accountLocked}" />
                        <h:inputHidden value="#{userForm.user.credentialsExpired}" />
                    </h:panelGroup>
                    <h:outputText />
                    <h:outputText />
                </c:otherwise>
            </c:choose>

            <h:panelGroup styleClass="buttonBar bottom">
                <h:commandButton value="#{text['button.save']}" action="#{userForm.save}" styleClass="button" />
                <h:commandButton value="#{text['button.cancel']}" action="#{userForm.cancel}" immediate="true"
                    styleClass="button" onclick="bCancel=true" />
            </h:panelGroup>
            <h:outputText />
            <h:outputText />
        </h:panelGrid>
    </h:form>

    <v:validatorScript functionName="validateUserForm" />
    <script type="text/javascript">
	Form.focusFirstElement($('userForm'));
	highlightFormElements();
</script>

</f:view>
</html>
